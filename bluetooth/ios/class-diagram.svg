<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="802px" preserveAspectRatio="none" style="width:1692px;height:802px;background:#FFFFFF;" version="1.1" viewBox="0 0 1692 802" width="1692px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nd9cnhwn6hbz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[0030d61d82e94361ea11284bf2289574]
class BLEDeviceControlRepositoryType--><rect codeLine="2" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="99.2188" id="BLEDeviceControlRepositoryType" style="stroke:#A80036;stroke-width:1.5;" width="760" x="918.5" y="222"/><ellipse cx="1191.75" cy="238" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1187.6719,233.7656 L1187.6719,231.6094 L1195.0625,231.6094 L1195.0625,233.7656 L1192.5938,233.7656 L1192.5938,241.8438 L1195.0625,241.8438 L1195.0625,244 L1187.6719,244 L1187.6719,241.8438 L1190.1406,241.8438 L1190.1406,233.7656 L1187.6719,233.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="205" x="1212.25" y="242.1543">BLEDeviceControlRepositoryType</text><line style="stroke:#A80036;stroke-width:1.5;" x1="919.5" x2="1677.5" y1="254" y2="254"/><line style="stroke:#A80036;stroke-width:1.5;" x1="919.5" x2="1677.5" y1="262" y2="262"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="926.5" y="270"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="734" x="938.5" y="276.2104">fetchDeviceState&lt;T: BLECodable&gt;(Device.ID, BLECharacteristic, stateType: T.Type) -&gt; Publisher&lt;Never, BLEDeviceControlError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="926.5" y="282.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="619" x="938.5" y="289.0151">latestDeviceState&lt;T: BLECodable&gt;(Device.ID, BLECharacteristic) -&gt; Publisher&lt;BLEDeviceState&lt;T&gt;?, Never&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="926.5" y="295.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="666" x="938.5" y="301.8198">setDeviceState&lt;T: BLECodable&gt;(Device.ID, BLECharacteristic, state: T) -&gt; Publisher&lt;Never, BLEDeviceControlError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="926.5" y="308.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="477" x="938.5" y="314.6245">removeDeviceState(Device.ID, BLECharacteristic) -&gt; SignalProducer&lt;Never, Never&gt;</text><!--MD5=[30d3e218cbdd5579420299a86f135f6a]
class BLEDeviceControlRepository--><rect fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="48" id="BLEDeviceControlRepository" style="stroke:#A80036;stroke-width:1.5;" width="206" x="677.5" y="247.5"/><ellipse cx="692.5" cy="263.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M695.4688,269.1406 Q694.8906,269.4375 694.25,269.5781 Q693.6094,269.7344 692.9063,269.7344 Q690.4063,269.7344 689.0781,268.0938 Q687.7656,266.4375 687.7656,263.3125 Q687.7656,260.1875 689.0781,258.5313 Q690.4063,256.875 692.9063,256.875 Q693.6094,256.875 694.25,257.0313 Q694.9063,257.1875 695.4688,257.4844 L695.4688,260.2031 Q694.8438,259.625 694.25,259.3594 Q693.6563,259.0781 693.0313,259.0781 Q691.6875,259.0781 691,260.1563 Q690.3125,261.2188 690.3125,263.3125 Q690.3125,265.4063 691,266.4844 Q691.6875,267.5469 693.0313,267.5469 Q693.6563,267.5469 694.25,267.2813 Q694.8438,267 695.4688,266.4219 L695.4688,269.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="174" x="706.5" y="267.6543">BLEDeviceControlRepository</text><line style="stroke:#A80036;stroke-width:1.5;" x1="678.5" x2="882.5" y1="279.5" y2="279.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="678.5" x2="882.5" y1="287.5" y2="287.5"/><!--MD5=[4ac3b019784f1e2cf6b72c71461be227]
class BLECharacteristic--><rect codeLine="10" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="86.4141" id="BLECharacteristic" style="stroke:#A80036;stroke-width:1.5;" width="318" x="299.5" y="228.5"/><ellipse cx="399.75" cy="244.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M403.8594,250.5 L396.1406,250.5 L396.1406,238.1094 L403.8594,238.1094 L403.8594,240.2656 L398.5938,240.2656 L398.5938,242.9375 L403.3594,242.9375 L403.3594,245.0938 L398.5938,245.0938 L398.5938,248.3438 L403.8594,248.3438 L403.8594,250.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109" x="420.25" y="248.6543">BLECharacteristic</text><line style="stroke:#A80036;stroke-width:1.5;" x1="300.5" x2="616.5" y1="260.5" y2="260.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="110" x="305.5" y="274.7104">serviceUUID: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="305.5" y="287.5151">characteristicUUID: String</text><line style="stroke:#A80036;stroke-width:1.5;" x1="300.5" x2="616.5" y1="294.1094" y2="294.1094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="305.5" y="308.3198">properties: Properties (read/write/notify permissions)</text><!--MD5=[6810d296ed95e7fe5e005a853f5ff265]
class BLEManagerType--><rect codeLine="16" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="150.4375" id="BLEManagerType" style="stroke:#A80036;stroke-width:1.5;" width="701" x="533" y="398"/><ellipse cx="825.25" cy="414" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M821.1719,409.7656 L821.1719,407.6094 L828.5625,407.6094 L828.5625,409.7656 L826.0938,409.7656 L826.0938,417.8438 L828.5625,417.8438 L828.5625,420 L821.1719,420 L821.1719,417.8438 L823.6406,417.8438 L823.6406,409.7656 L821.1719,409.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="108" x="845.75" y="418.1543">BLEManagerType</text><line style="stroke:#A80036;stroke-width:1.5;" x1="534" x2="1233" y1="430" y2="430"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="282" x="553" y="444.2104">bluetoothAuthorization: BLEBluetoothAuthorization</text><line style="stroke:#A80036;stroke-width:1.5;" x1="534" x2="1233" y1="450.8047" y2="450.8047"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="458.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="327" x="553" y="465.0151">bluetoothState() -&gt; Producer&lt;BLEBluetoothState, Never&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="471.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="586" x="553" y="477.8198">scan(serviceUUID: String?, allowDuplicates: Bool) -&gt; Publisher&lt;BLEScannedDevice, BLEManagerError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="484.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="673" x="553" y="490.6245">pairDevice(Device.ID, advertisingUUID, serviceUUID, userIdCharacteristic) -&gt; Publisher&lt;BLEDevice, BLEManagerError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="497.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="616" x="553" y="503.4292">readValueFromDevice&lt;T: BLEDecodable&gt;(Device.ID, BLECharacteristic) -&gt; Publisher&lt;T?, BLEManagerError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="510.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="675" x="553" y="516.2339">writeValueToDevice&lt;T: BLEEncodable&gt;(Device.ID, BLECharacteristic, value: T) -&gt; Publisher&lt;Never, BLEManagerError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="522.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="646" x="553" y="529.0386">subscribeValueFromDevice&lt;T: BLEDecodable&gt;(Device.ID, BLECharacteristic) -&gt; Publisher&lt;T?, BLEManagerError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="541" y="535.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="438" x="553" y="541.8433">peripheralConnected(to deviceId: Device.ID) -&gt; SignalProducer&lt;Bool, Never&gt;</text><!--MD5=[c5f6ea99cd99aac70d4cea85d6dcb022]
class BLEManager--><rect fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="48" id="BLEManager" style="stroke:#A80036;stroke-width:1.5;" width="109" x="389" y="449"/><ellipse cx="404" cy="465" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M406.9688,470.6406 Q406.3906,470.9375 405.75,471.0781 Q405.1094,471.2344 404.4063,471.2344 Q401.9063,471.2344 400.5781,469.5938 Q399.2656,467.9375 399.2656,464.8125 Q399.2656,461.6875 400.5781,460.0313 Q401.9063,458.375 404.4063,458.375 Q405.1094,458.375 405.75,458.5313 Q406.4063,458.6875 406.9688,458.9844 L406.9688,461.7031 Q406.3438,461.125 405.75,460.8594 Q405.1563,460.5781 404.5313,460.5781 Q403.1875,460.5781 402.5,461.6563 Q401.8125,462.7188 401.8125,464.8125 Q401.8125,466.9063 402.5,467.9844 Q403.1875,469.0469 404.5313,469.0469 Q405.1563,469.0469 405.75,468.7813 Q406.3438,468.5 406.9688,467.9219 L406.9688,470.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="77" x="418" y="469.1543">BLEManager</text><line style="stroke:#A80036;stroke-width:1.5;" x1="390" x2="497" y1="481" y2="481"/><line style="stroke:#A80036;stroke-width:1.5;" x1="390" x2="497" y1="489" y2="489"/><!--MD5=[a4af3620e608953a22bb4aecf07d1da6]
class BLEScannedDevice--><rect codeLine="28" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="73.6094" id="BLEScannedDevice" style="stroke:#A80036;stroke-width:1.5;" width="257" x="7" y="234.5"/><ellipse cx="72.25" cy="250.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76.3594,256.5 L68.6406,256.5 L68.6406,244.1094 L76.3594,244.1094 L76.3594,246.2656 L71.0938,246.2656 L71.0938,248.9375 L75.8594,248.9375 L75.8594,251.0938 L71.0938,251.0938 L71.0938,254.3438 L76.3594,254.3438 L76.3594,256.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="92.75" y="254.6543">BLEScannedDevice</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="263" y1="266.5" y2="266.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="124" x="13" y="280.7104">peripheral: BLEDevice</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="245" x="13" y="293.5151">advertisementData: BLEAdvertisementData</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="263" y1="300.1094" y2="300.1094"/><!--MD5=[1abbb94669035fbb7533aba036aa723e]
class BLEDevice--><rect codeLine="33" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="60.8047" id="BLEDevice" style="stroke:#A80036;stroke-width:1.5;" width="184" x="130.5" y="442.5"/><ellipse cx="186.75" cy="458.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M190.8594,464.5 L183.1406,464.5 L183.1406,452.1094 L190.8594,452.1094 L190.8594,454.2656 L185.5938,454.2656 L185.5938,456.9375 L190.3594,456.9375 L190.3594,459.0938 L185.5938,459.0938 L185.5938,462.3438 L190.8594,462.3438 L190.8594,464.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="63" x="207.25" y="462.6543">BLEDevice</text><line style="stroke:#A80036;stroke-width:1.5;" x1="131.5" x2="313.5" y1="474.5" y2="474.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="136.5" y="488.7104">peripheral: BLEPeripheralType</text><line style="stroke:#A80036;stroke-width:1.5;" x1="131.5" x2="313.5" y1="495.3047" y2="495.3047"/><!--MD5=[6b5ed944b36a582bf1e1682f6c01fbe0]
class BLEPeripheralType--><rect codeLine="37" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="137.6328" id="BLEPeripheralType" style="stroke:#A80036;stroke-width:1.5;" width="605" x="880" y="7"/><ellipse cx="1120.25" cy="23" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1116.1719,18.7656 L1116.1719,16.6094 L1123.5625,16.6094 L1123.5625,18.7656 L1121.0938,18.7656 L1121.0938,26.8438 L1123.5625,26.8438 L1123.5625,29 L1116.1719,29 L1116.1719,26.8438 L1118.6406,26.8438 L1118.6406,18.7656 L1116.1719,18.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="116" x="1140.75" y="27.1543">BLEPeripheralType</text><line style="stroke:#A80036;stroke-width:1.5;" x1="881" x2="1484" y1="39" y2="39"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="47"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="139" x="900" y="53.2104">peripheralName: String?</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="59.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="247" x="900" y="66.0151">peripheralState: BLEDeviceConnectionState</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="72.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="900" y="78.8198">peripheralID: UUID</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="85.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="270" x="900" y="91.6245">periheralServices: [BLEPeripheralServiceType]?</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="98.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="161" x="900" y="104.4292">isPeripheralConnected: Bool</text><line style="stroke:#A80036;stroke-width:1.5;" x1="881" x2="1484" y1="111.0234" y2="111.0234"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="119.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="533" x="900" y="125.2339">func establishConnection(options: [String: Any]?) -&gt; Publisher&lt;BLEPeripheralType, BLEError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="888" y="131.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="579" x="900" y="138.0386">func discoverServices(serviceUUIDs: [CBUUID]?) -&gt; Publisher&lt;[BLEPeripheralServiceType], BLEError&gt;</text><!--MD5=[9d31a74056dfc1c33cfaf421ad619400]
class BLEDeviceState--><rect codeLine="47" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="73.6094" id="BLEDeviceState" style="stroke:#A80036;stroke-width:1.5;" width="129" x="716" y="39"/><ellipse cx="731" cy="55" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M735.1094,61 L727.3906,61 L727.3906,48.6094 L735.1094,48.6094 L735.1094,50.7656 L729.8438,50.7656 L729.8438,53.4375 L734.6094,53.4375 L734.6094,55.5938 L729.8438,55.5938 L729.8438,58.8438 L735.1094,58.8438 L735.1094,61 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="745" y="59.1543">BLEDeviceState</text><line style="stroke:#A80036;stroke-width:1.5;" x1="717" x2="844" y1="71" y2="71"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="44" x="722" y="85.2104">state: T</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="722" y="98.0151">timestamp: Date</text><line style="stroke:#A80036;stroke-width:1.5;" x1="717" x2="844" y1="104.6094" y2="104.6094"/><!--MD5=[39d9532f12b88b142ed35d3005d63f6a]
class BLECodable--><rect codeLine="52" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="48" id="BLECodable" style="stroke:#A80036;stroke-width:1.5;" width="106" x="1519.5" y="52"/><ellipse cx="1534.5" cy="68" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1530.4219,63.7656 L1530.4219,61.6094 L1537.8125,61.6094 L1537.8125,63.7656 L1535.3438,63.7656 L1535.3438,71.8438 L1537.8125,71.8438 L1537.8125,74 L1530.4219,74 L1530.4219,71.8438 L1532.8906,71.8438 L1532.8906,63.7656 L1530.4219,63.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="1548.5" y="72.1543">BLECodable</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1520.5" x2="1624.5" y1="84" y2="84"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1520.5" x2="1624.5" y1="92" y2="92"/><!--MD5=[96addeebd3f495b16e7ae193481ae77a]
class BLEServiceType--><rect codeLine="54" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="163.2422" id="BLEServiceType" style="stroke:#A80036;stroke-width:1.5;" width="787" x="528" y="625"/><ellipse cx="868.25" cy="641" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M864.1719,636.7656 L864.1719,634.6094 L871.5625,634.6094 L871.5625,636.7656 L869.0938,636.7656 L869.0938,644.8438 L871.5625,644.8438 L871.5625,647 L864.1719,647 L864.1719,644.8438 L866.6406,644.8438 L866.6406,636.7656 L864.1719,636.7656 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="98" x="888.75" y="645.1543">BLEServiceType</text><line style="stroke:#A80036;stroke-width:1.5;" x1="529" x2="1314" y1="657" y2="657"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="665"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="282" x="548" y="671.2104">bluetoothAuthorization: BLEBluetoothAuthorization</text><line style="stroke:#A80036;stroke-width:1.5;" x1="529" x2="1314" y1="677.8047" y2="677.8047"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="685.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="329" x="548" y="692.0151">bluetoothState() -&gt; Publisher&lt;BLEBluetoothState, Never&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="698.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="557" x="548" y="704.8198">scan(for serviceUUID: String?, allowDuplicates: Bool) -&gt; Publisher&lt;BLEScannedDevice, BLEError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="711.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="409" x="548" y="717.6245">connectDevice(_ device: BLEDevice) -&gt; Publisher&lt;BLEDevice, BLEError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="724.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="707" x="548" y="730.4292">readDataFromDevice&lt;T: BLEDecodable&gt;(_ device: BLEDevice, characteristic: BLECharacteristic) -&gt; Publisher&lt;T?, BLEError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="737.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="761" x="548" y="743.2339">writeDataToDevice&lt;T: BLEEncodable&gt;(_ device: BLEDevice, characteristic: BLECharacteristic, data: T) -&gt; Publisher&lt;Never, BLEError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="749.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="742" x="548" y="756.0386">subscribeValueFromDevice&lt;T: BLEDecodable&gt;(_ device: BLEDevice, characteristic: BLECharacteristic) -&gt; Publisher&lt;T?, BLEError&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="762.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="378" x="548" y="768.8433">bleDevice(for bleDeviceId: UUID) -&gt; Publisher&lt;BLEDevice?, Never&gt;</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="536" y="775.4375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="467" x="548" y="781.6479">deviceState(_ bleDeviceId: UUID) -&gt; Publisher&lt;BLEDeviceConnectionState, Never&gt;</text><!--MD5=[8f5e5ebb9150de7675055e837a27c1ec]
class BLEService--><rect codeLine="66" fill="#FEFECE" filter="url(#f1nd9cnhwn6hbz)" height="48" id="BLEService" style="stroke:#A80036;stroke-width:1.5;" width="99" x="394" y="682.5"/><ellipse cx="409" cy="698.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M411.9688,704.1406 Q411.3906,704.4375 410.75,704.5781 Q410.1094,704.7344 409.4063,704.7344 Q406.9063,704.7344 405.5781,703.0938 Q404.2656,701.4375 404.2656,698.3125 Q404.2656,695.1875 405.5781,693.5313 Q406.9063,691.875 409.4063,691.875 Q410.1094,691.875 410.75,692.0313 Q411.4063,692.1875 411.9688,692.4844 L411.9688,695.2031 Q411.3438,694.625 410.75,694.3594 Q410.1563,694.0781 409.5313,694.0781 Q408.1875,694.0781 407.5,695.1563 Q406.8125,696.2188 406.8125,698.3125 Q406.8125,700.4063 407.5,701.4844 Q408.1875,702.5469 409.5313,702.5469 Q410.1563,702.5469 410.75,702.2813 Q411.3438,702 411.9688,701.4219 L411.9688,704.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="67" x="423" y="702.6543">BLEService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="395" x2="492" y1="714.5" y2="714.5"/><line style="stroke:#A80036;stroke-width:1.5;" x1="395" x2="492" y1="722.5" y2="722.5"/><!--MD5=[9fbb198aeae66241c45a25bc9b2dd71c]
link BLEDeviceControlRepository to BLEDeviceControlRepositoryType--><path codeLine="8" d="M883.7,271.5 C888.45,271.5 893.2,271.5 897.95,271.5 " fill="none" id="BLEDeviceControlRepository-to-BLEDeviceControlRepositoryType" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="898.13,264.5,918.13,271.5,898.13,278.5,898.13,264.5" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[d2b018e2bff56baca5528a4082a14d0e]
link BLEManager to BLEManagerType--><path codeLine="26" d="M498.07,473 C502.94,473 507.81,473 512.68,473 " fill="none" id="BLEManager-to-BLEManagerType" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="512.7,466,532.7,473,512.7,480,512.7,466" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[7903fba06f6246130d26c45e8b75ac35]
link BLEService to BLEServiceType--><path codeLine="67" d="M493.45,706.5 C498.18,706.5 502.91,706.5 507.64,706.5 " fill="none" id="BLEService-to-BLEServiceType" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="507.72,699.5,527.72,706.5,507.72,713.5,507.72,699.5" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[af444cb9dab7dfacac97ffb9b9450dcb]
reverse link BLECharacteristic to BLEDeviceControlRepository--><path codeLine="69" d="M622.84,271.5 C641.38,271.5 659.85,271.5 677.29,271.5 " fill="none" id="BLECharacteristic-backto-BLEDeviceControlRepository" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="617.61,271.5,626.61,275.5,622.61,271.5,626.61,267.5,617.61,271.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="636" y="264.5669">use</text><!--MD5=[fa9c79613a1b0f43c8f3c1fc3e7ce2a8]
link BLEDeviceControlRepository to BLEManager--><path codeLine="70" d="M715.99,295.53 C660.06,317.19 578.44,353 515.5,398 C496.82,411.36 478.8,429.88 465.46,445.06 " fill="none" id="BLEDeviceControlRepository-to-BLEManager" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="462.17,448.84,471.0889,444.6624,465.4463,445.063,465.0457,439.4203,462.17,448.84" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="591.5" y="364.0669">controls</text><!--MD5=[f0945684c6c031d8a32e7e38bb615924]
reverse link BLEDeviceState to BLEDeviceControlRepository--><path codeLine="71" d="M780.5,118.58 C780.5,157.92 780.5,215.55 780.5,247.33 " fill="none" id="BLEDeviceState-backto-BLEDeviceControlRepository" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="780.5,113.4,776.5,122.4,780.5,118.4,784.5,122.4,780.5,113.4" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="781.5" y="188.0669">fetch/write</text><!--MD5=[a0981d39ab0e3df71ad2dfbd166e42c6]
reverse link BLECharacteristic to BLEManager--><path codeLine="72" d="M454.92,320.18 C451.86,360.77 447.61,417.36 445.25,448.73 " fill="none" id="BLECharacteristic-backto-BLEManager" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="455.32,314.81,450.6377,323.4747,454.9343,319.7951,458.6139,324.0917,455.32,314.81" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="452.5" y="364.0669">fetch/write</text><!--MD5=[02cf6dfd866824e99346502c51c76947]
reverse link BLEScannedDevice to BLEManager--><path codeLine="73" d="M196.9,311.5 C235.61,336.16 286.58,368.78 331.5,398 C357.48,414.9 386.7,434.21 408.77,448.87 " fill="none" id="BLEScannedDevice-backto-BLEManager" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="192.25,308.53,197.6901,316.7401,196.4665,311.2172,201.9895,309.9936,192.25,308.53" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="284.5" y="364.0669">report</text><!--MD5=[1c1ddda81c100b414f2f7366da48a380]
reverse link BLEDevice to BLEManager--><path codeLine="74" d="M319.67,473 C343.36,473 367.88,473 388.79,473 " fill="none" id="BLEDevice-backto-BLEManager" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="314.62,473,323.62,477,319.62,473,323.62,469,314.62,473" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="340.25" y="466.0669">use</text><!--MD5=[19d5bb2d01e72edc5606f7711b29d948]
link BLEScannedDevice to BLEDevice--><path codeLine="75" d="M151.26,308.63 C167.24,345.27 191.79,401.58 207.49,437.59 " fill="none" id="BLEScannedDevice-to-BLEDevice" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="209.55,442.32,209.6185,432.4714,207.5512,437.7369,202.2856,435.6695,209.55,442.32" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="177.5" y="364.0669">contains</text><!--MD5=[3e7860f005818d1af4899d6ca11b06e8]
link BLEManager to BLEService--><path codeLine="76" d="M443.5,497.04 C443.5,539.66 443.5,630.66 443.5,677.05 " fill="none" id="BLEManager-to-BLEService" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="443.5,682.21,447.5,673.21,443.5,677.21,439.5,673.21,443.5,682.21" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="444.5" y="591.0669">controls</text><!--MD5=[d1f6f4637b2a8aeb6525b9f24fe95949]
@startuml

interface BLEDeviceControlRepositoryType {
  -fetchDeviceState<T: BLECodable>(Device.ID, BLECharacteristic, stateType: T.Type) -> Publisher<Never, BLEDeviceControlError>
  -latestDeviceState<T: BLECodable>(Device.ID, BLECharacteristic) -> Publisher<BLEDeviceState<T>?, Never>
  -setDeviceState<T: BLECodable>(Device.ID, BLECharacteristic, state: T) -> Publisher<Never, BLEDeviceControlError>
  -removeDeviceState(Device.ID, BLECharacteristic) -> SignalProducer<Never, Never>
}
BLEDeviceControlRepositoryType <|-left- BLEDeviceControlRepository

entity BLECharacteristic {
    serviceUUID: String
    characteristicUUID: String
    properties: Properties (read/write/notify permissions)
}

interface BLEManagerType {
    - bluetoothAuthorization: BLEBluetoothAuthorization 
    - bluetoothState() -> Producer<BLEBluetoothState, Never>
    - scan(serviceUUID: String?, allowDuplicates: Bool) -> Publisher<BLEScannedDevice, BLEManagerError>
    - pairDevice(Device.ID, advertisingUUID, serviceUUID, userIdCharacteristic) -> Publisher<BLEDevice, BLEManagerError>
    - readValueFromDevice<T: BLEDecodable>(Device.ID, BLECharacteristic) -> Publisher<T?, BLEManagerError>
    - writeValueToDevice<T: BLEEncodable>(Device.ID, BLECharacteristic, value: T) -> Publisher<Never, BLEManagerError>
    - subscribeValueFromDevice<T: BLEDecodable>(Device.ID, BLECharacteristic) -> Publisher<T?, BLEManagerError>
    - peripheralConnected(to deviceId: Device.ID) -> SignalProducer<Bool, Never>
}
BLEManagerType <|-left- BLEManager

entity BLEScannedDevice {
    peripheral: BLEDevice
    advertisementData: BLEAdvertisementData
}

entity BLEDevice {
    peripheral: BLEPeripheralType
}

interface BLEPeripheralType {
    - peripheralName: String? 
    - peripheralState: BLEDeviceConnectionState
    - peripheralID: UUID 
    - periheralServices: [BLEPeripheralServiceType]? 
    - isPeripheralConnected: Bool
    - func establishConnection(options: [String: Any]?) -> Publisher<BLEPeripheralType, BLEError>
    - func discoverServices(serviceUUIDs: [CBUUID]?) -> Publisher<[BLEPeripheralServiceType], BLEError>
}

entity BLEDeviceState {
    state: T
    timestamp: Date
}

interface BLECodable {}

interface BLEServiceType {
    - bluetoothAuthorization: BLEBluetoothAuthorization
    - bluetoothState() -> Publisher<BLEBluetoothState, Never>
    - scan(for serviceUUID: String?, allowDuplicates: Bool) -> Publisher<BLEScannedDevice, BLEError>
    - connectDevice(_ device: BLEDevice) -> Publisher<BLEDevice, BLEError>
    - readDataFromDevice<T: BLEDecodable>(_ device: BLEDevice, characteristic: BLECharacteristic) -> Publisher<T?, BLEError>
    - writeDataToDevice<T: BLEEncodable>(_ device: BLEDevice, characteristic: BLECharacteristic, data: T) -> Publisher<Never, BLEError>
    - subscribeValueFromDevice<T: BLEDecodable>(_ device: BLEDevice, characteristic: BLECharacteristic) -> Publisher<T?, BLEError>
    - bleDevice(for bleDeviceId: UUID) -> Publisher<BLEDevice?, Never>
    - deviceState(_ bleDeviceId: UUID) -> Publisher<BLEDeviceConnectionState, Never>
}

class BLEService
BLEServiceType <|-left- BLEService

BLEDeviceControlRepository -left-> BLECharacteristic: use
BLEDeviceControlRepository -down-> BLEManager: controls
BLEDeviceControlRepository -up-> BLEDeviceState: fetch/write
BLEManager -left-> BLECharacteristic: fetch/write
BLEManager -left-> BLEScannedDevice: report
BLEManager -left-> BLEDevice: use
BLEScannedDevice - -> BLEDevice: contains
BLEManager -down-> BLEService: controls
@enduml

PlantUML version 1.2021.11(Sat Oct 02 13:26:11 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>