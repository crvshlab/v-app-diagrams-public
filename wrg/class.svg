<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="828px" preserveAspectRatio="none" style="width:2129px;height:828px;background:#FFFFFF;" version="1.1" viewBox="0 0 2129 828" width="2129px" zoomAndPan="magnify"><defs><filter height="300%" id="fy4dfgjh8rky9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[422f32e14b749b8fb02ca25937777587]
class WRGStatus--><rect codeLine="1" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="99.2188" id="WRGStatus" style="stroke:#A80036;stroke-width:1.5;" width="112" x="821" y="7"/><ellipse cx="836" cy="23" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M840.1094,29 L832.3906,29 L832.3906,16.6094 L840.1094,16.6094 L840.1094,18.7656 L834.8438,18.7656 L834.8438,21.4375 L839.6094,21.4375 L839.6094,23.5938 L834.8438,23.5938 L834.8438,26.8438 L840.1094,26.8438 L840.1094,29 Z " fill="#000000"/><ellipse cx="855" cy="22.5" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69" x="861" y="27.1543">WRGStatus</text><line style="stroke:#A80036;stroke-width:1.5;" x1="822" x2="932" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="24" x="827" y="53.2104">IDLE</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="827" y="66.0151">CONNECTING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="827" y="78.8198">REGISTERED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="827" y="91.6245">FAILED</text><line style="stroke:#A80036;stroke-width:1.5;" x1="822" x2="932" y1="98.2188" y2="98.2188"/><!--MD5=[11ff4f83bdd011ecce3eaefab1505150]
class WRGType--><rect codeLine="8" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="73.6094" id="WRGType" style="stroke:#A80036;stroke-width:1.5;" width="100" x="968" y="19.5"/><ellipse cx="983" cy="35.5" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M987.1094,41.5 L979.3906,41.5 L979.3906,29.1094 L987.1094,29.1094 L987.1094,31.2656 L981.8438,31.2656 L981.8438,33.9375 L986.6094,33.9375 L986.6094,36.0938 L981.8438,36.0938 L981.8438,39.3438 L987.1094,39.3438 L987.1094,41.5 Z " fill="#000000"/><ellipse cx="1002" cy="35" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="57" x="1008" y="39.6543">WRGType</text><line style="stroke:#A80036;stroke-width:1.5;" x1="969" x2="1067" y1="51.5" y2="51.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="974" y="65.7104">CHAT</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="974" y="78.5151">VOICE</text><line style="stroke:#A80036;stroke-width:1.5;" x1="969" x2="1067" y1="85.1094" y2="85.1094"/><!--MD5=[0c456de9f81515078d6382ca56629a09]
class WRGAuthData--><rect codeLine="13" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="86.4141" id="WRGAuthData" style="stroke:#A80036;stroke-width:1.5;" width="130" x="812" y="185.5"/><ellipse cx="827" cy="201.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M829.9688,207.1406 Q829.3906,207.4375 828.75,207.5781 Q828.1094,207.7344 827.4063,207.7344 Q824.9063,207.7344 823.5781,206.0938 Q822.2656,204.4375 822.2656,201.3125 Q822.2656,198.1875 823.5781,196.5313 Q824.9063,194.875 827.4063,194.875 Q828.1094,194.875 828.75,195.0313 Q829.4063,195.1875 829.9688,195.4844 L829.9688,198.2031 Q829.3438,197.625 828.75,197.3594 Q828.1563,197.0781 827.5313,197.0781 Q826.1875,197.0781 825.5,198.1563 Q824.8125,199.2188 824.8125,201.3125 Q824.8125,203.4063 825.5,204.4844 Q826.1875,205.5469 827.5313,205.5469 Q828.1563,205.5469 828.75,205.2813 Q829.3438,205 829.9688,204.4219 L829.9688,207.1406 Z " fill="#000000"/><ellipse cx="846" cy="201" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="852" y="205.6543">WRGAuthData</text><line style="stroke:#A80036;stroke-width:1.5;" x1="813" x2="941" y1="217.5" y2="217.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="820" y="225.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="81" x="832" y="231.7104">clientId: string</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="820" y="238.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="832" y="244.5151">sessionId: string</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="820" y="251.1094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="832" y="257.3198">token: string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="813" x2="941" y1="263.9141" y2="263.9141"/><!--MD5=[6cd4291a55d573d0d9b1338eb540a0c9]
class WRG--><rect codeLine="19" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="124.8281" id="WRG" style="stroke:#A80036;stroke-width:1.5;" width="216" x="447" y="166"/><ellipse cx="531.25" cy="182" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M534.2188,187.6406 Q533.6406,187.9375 533,188.0781 Q532.3594,188.2344 531.6563,188.2344 Q529.1563,188.2344 527.8281,186.5938 Q526.5156,184.9375 526.5156,181.8125 Q526.5156,178.6875 527.8281,177.0313 Q529.1563,175.375 531.6563,175.375 Q532.3594,175.375 533,175.5313 Q533.6563,175.6875 534.2188,175.9844 L534.2188,178.7031 Q533.5938,178.125 533,177.8594 Q532.4063,177.5781 531.7813,177.5781 Q530.4375,177.5781 529.75,178.6563 Q529.0625,179.7188 529.0625,181.8125 Q529.0625,183.9063 529.75,184.9844 Q530.4375,186.0469 531.7813,186.0469 Q532.4063,186.0469 533,185.7813 Q533.5938,185.5 534.2188,184.9219 L534.2188,187.6406 Z " fill="#000000"/><ellipse cx="556.75" cy="181.5" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="28" x="562.75" y="186.1543">WRG</text><line style="stroke:#A80036;stroke-width:1.5;" x1="448" x2="662" y1="198" y2="198"/><ellipse cx="458" cy="209" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="84" x="467" y="212.2104">type: WRGType</text><ellipse cx="458" cy="221.8047" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="467" y="225.0151">webSocket: WebSocketRepository</text><ellipse cx="458" cy="234.6094" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="189" x="467" y="237.8198">status: Observable&lt;WRGStatus&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="448" x2="662" y1="244.4141" y2="244.4141"/><ellipse cx="458" cy="255.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="467" y="258.6245">WRG(type: WRGType)</text><ellipse cx="458" cy="268.2188" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="52" x="467" y="271.4292">connect()</text><ellipse cx="458" cy="281.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="69" x="467" y="284.2339">disconnect()</text><path d="M6,211 L6,236.1328 A0,0 0 0 0 6,236.1328 L412,236.1328 A0,0 0 0 0 412,236.1328 L412,229 L451,267.6211 L412,221 L412,221 L402,211 L6,211 A0,0 0 0 0 6,211 " fill="#FBFB77" filter="url(#fy4dfgjh8rky9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M402,211 L402,221 L412,221 L402,211 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="12" y="228.0669">Starts `registration` and establishes WebSocket Connection</text><!--MD5=[87431058471752df5b1c591a901267f7]
class VoiceWRG--><rect codeLine="33" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="60.8047" id="VoiceWRG" style="stroke:#A80036;stroke-width:1.5;" width="123" x="415.5" y="26"/><ellipse cx="438.6" cy="42" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M441.5688,47.6406 Q440.9906,47.9375 440.35,48.0781 Q439.7094,48.2344 439.0063,48.2344 Q436.5063,48.2344 435.1781,46.5938 Q433.8656,44.9375 433.8656,41.8125 Q433.8656,38.6875 435.1781,37.0313 Q436.5063,35.375 439.0063,35.375 Q439.7094,35.375 440.35,35.5313 Q441.0063,35.6875 441.5688,35.9844 L441.5688,38.7031 Q440.9438,38.125 440.35,37.8594 Q439.7563,37.5781 439.1313,37.5781 Q437.7875,37.5781 437.1,38.6563 Q436.4125,39.7188 436.4125,41.8125 Q436.4125,43.9063 437.1,44.9844 Q437.7875,46.0469 439.1313,46.0469 Q439.7563,46.0469 440.35,45.7813 Q440.9438,45.5 441.5688,44.9219 L441.5688,47.6406 Z " fill="#000000"/><ellipse cx="459.4" cy="41.5" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="465.4" y="46.1543">VoiceWRG</text><line style="stroke:#A80036;stroke-width:1.5;" x1="416.5" x2="537.5" y1="58" y2="58"/><ellipse cx="426.5" cy="69" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="435.5" y="72.2104">api: WRGVoiceAPI</text><line style="stroke:#A80036;stroke-width:1.5;" x1="416.5" x2="537.5" y1="78.8047" y2="78.8047"/><!--MD5=[9e4f34c8d4f7f7a12d643de2d4e8f14e]
class ChatWRG--><rect codeLine="37" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="60.8047" id="ChatWRG" style="stroke:#A80036;stroke-width:1.5;" width="119" x="573.5" y="26"/><ellipse cx="597.05" cy="42" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M600.0188,47.6406 Q599.4406,47.9375 598.8,48.0781 Q598.1594,48.2344 597.4563,48.2344 Q594.9563,48.2344 593.6281,46.5938 Q592.3156,44.9375 592.3156,41.8125 Q592.3156,38.6875 593.6281,37.0313 Q594.9563,35.375 597.4563,35.375 Q598.1594,35.375 598.8,35.5313 Q599.4563,35.6875 600.0188,35.9844 L600.0188,38.7031 Q599.3938,38.125 598.8,37.8594 Q598.2063,37.5781 597.5813,37.5781 Q596.2375,37.5781 595.55,38.6563 Q594.8625,39.7188 594.8625,41.8125 Q594.8625,43.9063 595.55,44.9844 Q596.2375,46.0469 597.5813,46.0469 Q598.2063,46.0469 598.8,45.7813 Q599.3938,45.5 600.0188,44.9219 L600.0188,47.6406 Z " fill="#000000"/><ellipse cx="617.95" cy="41.5" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="57" x="623.95" y="46.1543">ChatWRG</text><line style="stroke:#A80036;stroke-width:1.5;" x1="574.5" x2="691.5" y1="58" y2="58"/><ellipse cx="584.5" cy="69" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="593.5" y="72.2104">api: WRGChatAPI</text><line style="stroke:#A80036;stroke-width:1.5;" x1="574.5" x2="691.5" y1="78.8047" y2="78.8047"/><!--MD5=[8b9800b01682362c8ee0fec59d1ed0c9]
class WebSocketRepository--><rect codeLine="41" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="60.8047" id="WebSocketRepository" style="stroke:#A80036;stroke-width:1.5;" width="245" x="362.5" y="472.5"/><ellipse cx="407.25" cy="488.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M410.2188,494.1406 Q409.6406,494.4375 409,494.5781 Q408.3594,494.7344 407.6563,494.7344 Q405.1563,494.7344 403.8281,493.0938 Q402.5156,491.4375 402.5156,488.3125 Q402.5156,485.1875 403.8281,483.5313 Q405.1563,481.875 407.6563,481.875 Q408.3594,481.875 409,482.0313 Q409.6563,482.1875 410.2188,482.4844 L410.2188,485.2031 Q409.5938,484.625 409,484.3594 Q408.4063,484.0781 407.7813,484.0781 Q406.4375,484.0781 405.75,485.1563 Q405.0625,486.2188 405.0625,488.3125 Q405.0625,490.4063 405.75,491.4844 Q406.4375,492.5469 407.7813,492.5469 Q408.4063,492.5469 409,492.2813 Q409.5938,492 410.2188,491.4219 L410.2188,494.1406 Z " fill="#000000"/><ellipse cx="432.75" cy="488" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="438.75" y="492.6543">WebSocketRepository</text><line style="stroke:#A80036;stroke-width:1.5;" x1="363.5" x2="606.5" y1="504.5" y2="504.5"/><ellipse cx="373.5" cy="515.5" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="219" x="382.5" y="518.7104">messages: Observable&lt;WSMessage&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="363.5" x2="606.5" y1="525.3047" y2="525.3047"/><!--MD5=[4f2c074e928f6bcd02c216b9e1e9c59b]
class WRGRegistrationUseCase--><rect codeLine="45" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="86.4141" id="WRGRegistrationUseCase" style="stroke:#A80036;stroke-width:1.5;" width="384" x="643" y="460"/><ellipse cx="745.75" cy="476" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M748.7188,481.6406 Q748.1406,481.9375 747.5,482.0781 Q746.8594,482.2344 746.1563,482.2344 Q743.6563,482.2344 742.3281,480.5938 Q741.0156,478.9375 741.0156,475.8125 Q741.0156,472.6875 742.3281,471.0313 Q743.6563,469.375 746.1563,469.375 Q746.8594,469.375 747.5,469.5313 Q748.1563,469.6875 748.7188,469.9844 L748.7188,472.7031 Q748.0938,472.125 747.5,471.8594 Q746.9063,471.5781 746.2813,471.5781 Q744.9375,471.5781 744.25,472.6563 Q743.5625,473.7188 743.5625,475.8125 Q743.5625,477.9063 744.25,478.9844 Q744.9375,480.0469 746.2813,480.0469 Q746.9063,480.0469 747.5,479.7813 Q748.0938,479.5 748.7188,478.9219 L748.7188,481.6406 Z " fill="#000000"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="768.25" y="472.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="777.25" y="480.1543">WRGRegistrationUseCase</text><line style="stroke:#A80036;stroke-width:1.5;" x1="644" x2="1026" y1="492" y2="492"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="372" x="649" y="506.2104">// TODO: Find better name? WRGRegisterer? WRGRegistrationFlow</text><line style="stroke:#A80036;stroke-width:1.5;" x1="644" x2="1026" y1="512.8047" y2="512.8047"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="651" y="520.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="305" x="663" y="527.0151">WRGRegistrationUseCase(WRGRegistrationRepository)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="651" y="533.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="234" x="663" y="539.8198">register(WRGType, WebSocketRepository)</text><!--MD5=[e514f70476f9ba86a923f12283f39fed]
class WRGChatAPI--><rect codeLine="61" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="112.0234" id="WRGChatAPI" style="stroke:#A80036;stroke-width:1.5;" width="330" x="1695" y="172.5"/><ellipse cx="1812.25" cy="188.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1815.2188,194.1406 Q1814.6406,194.4375 1814,194.5781 Q1813.3594,194.7344 1812.6563,194.7344 Q1810.1563,194.7344 1808.8281,193.0938 Q1807.5156,191.4375 1807.5156,188.3125 Q1807.5156,185.1875 1808.8281,183.5313 Q1810.1563,181.875 1812.6563,181.875 Q1813.3594,181.875 1814,182.0313 Q1814.6563,182.1875 1815.2188,182.4844 L1815.2188,185.2031 Q1814.5938,184.625 1814,184.3594 Q1813.4063,184.0781 1812.7813,184.0781 Q1811.4375,184.0781 1810.75,185.1563 Q1810.0625,186.2188 1810.0625,188.3125 Q1810.0625,190.4063 1810.75,191.4844 Q1811.4375,192.5469 1812.7813,192.5469 Q1813.4063,192.5469 1814,192.2813 Q1814.5938,192 1815.2188,191.4219 L1815.2188,194.1406 Z " fill="#000000"/><ellipse cx="1837.75" cy="188" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76" x="1843.75" y="192.6543">WRGChatAPI</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1696" x2="2024" y1="204.5" y2="204.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="224" x="1701" y="218.7104">// TODO: Define more specific interface</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1696" x2="2024" y1="225.3047" y2="225.3047"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1703" y="233.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="304" x="1715" y="239.5151">WRGChatAPI(WRGService, WRGRegistrationRepository)</text><ellipse cx="1706" cy="249.1094" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="1715" y="252.3198">sendInitialMessage()</text><ellipse cx="1706" cy="261.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="1715" y="265.1245">sendMessage()</text><ellipse cx="1706" cy="274.7188" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="132" x="1715" y="277.9292">acknowledgeMessage()</text><path d="M1599.5,44 L1599.5,69.1328 A0,0 0 0 0 1599.5,69.1328 L1856,69.1328 L1860,172.38 L1864,69.1328 L2120.5,69.1328 A0,0 0 0 0 2120.5,69.1328 L2120.5,54 L2110.5,44 L1599.5,44 A0,0 0 0 0 1599.5,44 " fill="#FBFB77" filter="url(#fy4dfgjh8rky9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2110.5,44 L2110.5,54 L2120.5,54 L2110.5,44 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="500" x="1605.5" y="61.0669">exposes chat REST API authenticating it with injected AuthenticationRepository</text><!--MD5=[001c9cc3f66b2ef5070204ebb03fab5b]
class WRGVoiceAPI--><rect codeLine="64" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="112.0234" id="WRGVoiceAPI" style="stroke:#A80036;stroke-width:1.5;" width="542" x="1118" y="172.5"/><ellipse cx="1338.75" cy="188.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1341.7188,194.1406 Q1341.1406,194.4375 1340.5,194.5781 Q1339.8594,194.7344 1339.1563,194.7344 Q1336.6563,194.7344 1335.3281,193.0938 Q1334.0156,191.4375 1334.0156,188.3125 Q1334.0156,185.1875 1335.3281,183.5313 Q1336.6563,181.875 1339.1563,181.875 Q1339.8594,181.875 1340.5,182.0313 Q1341.1563,182.1875 1341.7188,182.4844 L1341.7188,185.2031 Q1341.0938,184.625 1340.5,184.3594 Q1339.9063,184.0781 1339.2813,184.0781 Q1337.9375,184.0781 1337.25,185.1563 Q1336.5625,186.2188 1336.5625,188.3125 Q1336.5625,190.4063 1337.25,191.4844 Q1337.9375,192.5469 1339.2813,192.5469 Q1339.9063,192.5469 1340.5,192.2813 Q1341.0938,192 1341.7188,191.4219 L1341.7188,194.1406 Z " fill="#000000"/><ellipse cx="1364.25" cy="188" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="1370.25" y="192.6543">WRGVoiceAPI</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1119" x2="1659" y1="204.5" y2="204.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="1124" y="218.7104">// Device.ID or telUri?</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1119" x2="1659" y1="225.3047" y2="225.3047"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1126" y="233.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="308" x="1138" y="239.5151">WRGVoiceAPI(WRGService, WRGRegistrationRepository)</text><ellipse cx="1129" cy="249.1094" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="516" x="1138" y="252.3198">startVoIPCall(sdp: string, clientCorrelator: string, originator: Device.ID, receiver: Device.ID)</text><ellipse cx="1129" cy="261.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="144" x="1138" y="265.1245">endVoIPCall(callId: string)</text><ellipse cx="1129" cy="274.7188" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="327" x="1138" y="277.9292">sendVoIPSessionStatus(callId: string, receiver: Device.ID)</text><!--MD5=[5a2fac663bf0f175e2592d3fc8b8a766]
class WRGRegistrationRepository--><rect codeLine="73" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="99.2188" id="WRGRegistrationRepository" style="stroke:#A80036;stroke-width:1.5;" width="427" x="621.5" y="715"/><ellipse cx="740.25" cy="731" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M743.2188,736.6406 Q742.6406,736.9375 742,737.0781 Q741.3594,737.2344 740.6563,737.2344 Q738.1563,737.2344 736.8281,735.5938 Q735.5156,733.9375 735.5156,730.8125 Q735.5156,727.6875 736.8281,726.0313 Q738.1563,724.375 740.6563,724.375 Q741.3594,724.375 742,724.5313 Q742.6563,724.6875 743.2188,724.9844 L743.2188,727.7031 Q742.5938,727.125 742,726.8594 Q741.4063,726.5781 740.7813,726.5781 Q739.4375,726.5781 738.75,727.6563 Q738.0625,728.7188 738.0625,730.8125 Q738.0625,732.9063 738.75,733.9844 Q739.4375,735.0469 740.7813,735.0469 Q741.4063,735.0469 742,734.7813 Q742.5938,734.5 743.2188,733.9219 L743.2188,736.6406 Z " fill="#000000"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="762.75" y="727.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="771.75" y="735.1543">WRGRegistrationRepository</text><line style="stroke:#A80036;stroke-width:1.5;" x1="622.5" x2="1047.5" y1="747" y2="747"/><line style="stroke:#A80036;stroke-width:1.5;" x1="622.5" x2="1047.5" y1="755" y2="755"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="401" x="641.5" y="769.2104">// Exposes REST endpoints and stores credentials (clientId, sessionId)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="629.5" y="775.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="228" x="641.5" y="782.0151">WRGRegistrationRepository(WRGService)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="645.5" y="794.8198"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="629.5" y="801.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="641.5" y="807.6245">authData(for deviceId: Device.ID)</text><!--MD5=[c0584d362fe6d201cbf2ddf6b6491907]
class WRGService--><rect codeLine="103" fill="#FEFECE" filter="url(#fy4dfgjh8rky9)" height="304.0938" id="WRGService" style="stroke:#A80036;stroke-width:1.5;" width="194" x="1441" y="351"/><ellipse cx="1491.75" cy="367" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1494.7188,372.6406 Q1494.1406,372.9375 1493.5,373.0781 Q1492.8594,373.2344 1492.1563,373.2344 Q1489.6563,373.2344 1488.3281,371.5938 Q1487.0156,369.9375 1487.0156,366.8125 Q1487.0156,363.6875 1488.3281,362.0313 Q1489.6563,360.375 1492.1563,360.375 Q1492.8594,360.375 1493.5,360.5313 Q1494.1563,360.6875 1494.7188,360.9844 L1494.7188,363.7031 Q1494.0938,363.125 1493.5,362.8594 Q1492.9063,362.5781 1492.2813,362.5781 Q1490.9375,362.5781 1490.25,363.6563 Q1489.5625,364.7188 1489.5625,366.8125 Q1489.5625,368.9063 1490.25,369.9844 Q1490.9375,371.0469 1492.2813,371.0469 Q1492.9063,371.0469 1493.5,370.7813 Q1494.0938,370.5 1494.7188,369.9219 L1494.7188,372.6406 Z " fill="#000000"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1514.25" y="363.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="73" x="1523.25" y="371.1543">WRGService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1442" x2="1634" y1="383" y2="383"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1442" x2="1634" y1="391" y2="391"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="399"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="1461" y="405.2104">sendInitialMessage()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="411.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="1461" y="418.0151">sendMessage()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="424.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="132" x="1461" y="430.8198">acknowledgeMessage()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="1465" y="443.6245"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="450.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="80" x="1461" y="456.4292">startVoIPCall()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="463.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="74" x="1461" y="469.2339">endVoIPCall()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="475.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="1461" y="482.0386">sendVoIPSessionStatus()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="1465" y="494.8433"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="501.4375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="147" x="1461" y="507.6479">getWebRTCConfiguration()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="514.2422"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="168" x="1461" y="520.4526">updateWebRTCConfiguration()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="527.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="138" x="1461" y="533.2573">generateWebRTCToken()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="539.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="103" x="1461" y="546.062">startRegistration()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="552.6563"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="1461" y="558.8667">createNotificationChannel()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="565.4609"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="1461" y="571.6714">getLineInfo()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="578.2656"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="81" x="1461" y="584.4761">getCapability()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="591.0703"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="107" x="1461" y="597.2808">finishRegistration()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="603.875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="1461" y="610.0854">refreshRegistration()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="616.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="111" x="1461" y="622.8901">deleteRegistration()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="629.4844"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="1461" y="635.6948">refreshClientSession()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="1449" y="642.2891"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="1461" y="648.4995">refreshNotificationChannel()</text><path d="M1272,752 L1272,777.1328 A0,0 0 0 0 1272,777.1328 L1804,777.1328 A0,0 0 0 0 1804,777.1328 L1804,762 L1794,752 L1542,752 L1538,655.33 L1534,752 L1272,752 A0,0 0 0 0 1272,752 " fill="#FBFB77" filter="url(#fy4dfgjh8rky9)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1794,752 L1794,762 L1804,762 L1794,752 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="511" x="1278" y="769.0669">All methods represent REST endpoints with parameters defined by Mavenir spec</text><!--MD5=[02ee632ab86a36761cb1401dec27d50b]
link WRG$$$LEFT to WRG--><!--MD5=[a4540816900ad98aa63df4c924b6923f]
reverse link WRG to WebSocketRepository--><path codeLine="106" d="M535.87,303.95 C521.63,359.4 502.94,432.17 492.64,472.27 " fill="none" id="WRG-backto-WebSocketRepository" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="539.12,291.33,533.7508,296.1437,536.129,302.9513,541.4983,298.1376,539.12,291.33" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b49c3b077bfb469b7d6b78b1dbf2308b]
reverse link WRG to WRGRegistrationUseCase--><path codeLine="107" d="M628.05,300.59 C680.03,351.18 748.13,417.45 791.73,459.89 " fill="none" id="WRG-backto-WRGRegistrationUseCase" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="618.54,291.33,620.0475,298.3818,627.1366,299.7025,625.6291,292.6507,618.54,291.33" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[0f3e827589f6a0afa43e875f2c57c34a]
reverse link WRGRegistrationUseCase to WRGRegistrationRepository--><path codeLine="108" d="M835,559.33 C835,605.41 835,670.42 835,714.61 " fill="none" id="WRGRegistrationUseCase-backto-WRGRegistrationRepository" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="835,546.27,831,552.27,835,558.27,839,552.27,835,546.27" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[8dbba4ec38d8f2d59f6d2ff5332d92ea]
reverse link VoiceWRG to WRG--><path codeLine="110" d="M498.97,105.38 C507.58,124.16 517.58,145.93 526.72,165.86 " fill="none" id="VoiceWRG-backto-WRG" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="492.56,108.21,490.59,87.11,505.29,102.37,492.56,108.21" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[57f441d26ba2f5da21eae87758040244]
reverse link ChatWRG to WRG--><path codeLine="112" d="M611.03,105.38 C602.42,124.16 592.42,145.93 583.28,165.86 " fill="none" id="ChatWRG-backto-WRG" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="604.71,102.37,619.41,87.11,617.44,108.21,604.71,102.37" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[6dec238cd4b798ea7942fcbdf96d8396]
reverse link WRGVoiceAPI to WRGService--><path codeLine="114" d="M1425.61,296.46 C1434.75,313.17 1444.93,331.78 1455.32,350.79 " fill="none" id="WRGVoiceAPI-backto-WRGService" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1419.15,284.64,1418.5166,291.8232,1424.9036,295.1707,1425.537,287.9875,1419.15,284.64" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[8b81ac05195cce2b043d83c361a2914d]
reverse link WRGChatAPI to WRGService--><path codeLine="115" d="M1784.65,293.26 C1740.06,331 1683.1,379.21 1635.15,419.78 " fill="none" id="WRGChatAPI-backto-WRGService" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1794.84,284.64,1787.6752,285.4556,1785.6724,292.383,1792.8372,291.5674,1794.84,284.64" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[993087409945a2f15d16822c16875259]
link WRGStatus to WRGType--><!--MD5=[703dcbebc47ef18eb7d0f09d18e5f915]
link WRGStatus to WRGAuthData--><!--MD5=[c78aad66c4ee4f37083c7213f77947b7]
@startuml
+enum WRGStatus {
    IDLE
    CONNECTING
    REGISTERED
    FAILED
}

+enum WRGType {
    CHAT
    VOICE
}

+class WRGAuthData {
    -clientId: string
    -sessionId: string
    -token: string
}

+class WRG {
    +WRG(type: WRGType)
    +connect()
    +disconnect()

    +type: WRGType
    +webSocket: WebSocketRepository
    +status: Observable<WRGStatus>
}

note left of WRG::connect
  Starts `registration` and establishes WebSocket Connection
end note

+class VoiceWRG {
    +api: WRGVoiceAPI
}

+class ChatWRG {
    +api: WRGChatAPI
}

+class WebSocketRepository {
    +messages: Observable<WSMessage>
}

-class WRGRegistrationUseCase {
    // TODO: Find better name? WRGRegisterer? WRGRegistrationFlow
    -WRGRegistrationUseCase(WRGRegistrationRepository)
    -register(WRGType, WebSocketRepository)
}

+class WRGChatAPI {

    -WRGChatAPI(WRGService, WRGRegistrationRepository)

    // TODO: Define more specific interface
    +sendInitialMessage()
    +sendMessage()
    +acknowledgeMessage()
}

class WRGChatAPI
note top: exposes chat REST API authenticating it with injected AuthenticationRepository

+class WRGVoiceAPI {
    -WRGVoiceAPI(WRGService, WRGRegistrationRepository)

    // Device.ID or telUri?
    +startVoIPCall(sdp: string, clientCorrelator: string, originator: Device.ID, receiver: Device.ID)
    +endVoIPCall(callId: string)
    +sendVoIPSessionStatus(callId: string, receiver: Device.ID)
}

-class WRGRegistrationRepository {
    // Exposes REST endpoints and stores credentials (clientId, sessionId)
    -WRGRegistrationRepository(WRGService)

    -authData(for deviceId: Device.ID)
}

-class WRGService {
    -sendInitialMessage()
    -sendMessage()
    -acknowledgeMessage()
    
    -startVoIPCall()
    -endVoIPCall()
    -sendVoIPSessionStatus()
    
    -getWebRTCConfiguration()
    -updateWebRTCConfiguration()
    -generateWebRTCToken()
    -startRegistration()
    -createNotificationChannel()
    -getLineInfo()
    -getCapability()
    -finishRegistration()
    -refreshRegistration()
    -deleteRegistration()
    -refreshClientSession()
    -refreshNotificationChannel()
}

class WRGService
note bottom: All methods represent REST endpoints with parameters defined by Mavenir spec

WRG *- - WebSocketRepository
WRG *- - WRGRegistrationUseCase
WRGRegistrationUseCase *- - WRGRegistrationRepository

VoiceWRG <|- - WRG

ChatWRG <|- - WRG

WRGVoiceAPI *- - WRGService
WRGChatAPI *- - WRGService
@enduml

PlantUML version 1.2021.11(Sat Oct 02 13:26:11 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>