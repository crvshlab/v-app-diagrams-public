<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="739px" preserveAspectRatio="none" style="width:861px;height:739px;background:#FFFFFF;" version="1.1" viewBox="0 0 861 739" width="861px" zoomAndPan="magnify"><defs><filter height="300%" id="f1lo4s9hdqn008" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" filter="url(#f1lo4s9hdqn008)" height="621.875" style="stroke:#000000;stroke-width:2.0;" width="837" x="10" y="57.2969"/><rect fill="#ADD8E6" filter="url(#f1lo4s9hdqn008)" height="498.6094" style="stroke:#000000;stroke-width:2.0;" width="817" x="20" y="148.5625"/><rect fill="#ADD8E6" filter="url(#f1lo4s9hdqn008)" height="169.3359" style="stroke:#000000;stroke-width:2.0;" width="797" x="30" y="226.8281"/><rect fill="#ADD8E6" height="98.0703" style="stroke:none;stroke-width:1.0;" width="797" x="30" y="298.0938"/><rect fill="#ADD8E6" height="219.0078" style="stroke:none;stroke-width:1.0;" width="817" x="20" y="428.1641"/><rect fill="#ADD8E6" filter="url(#f1lo4s9hdqn008)" height="140.2031" style="stroke:#000000;stroke-width:2.0;" width="305" x="30" y="474.9688"/><rect fill="#ADD8E6" height="68.9375" style="stroke:none;stroke-width:1.0;" width="305" x="30" y="546.2344"/><line style="stroke:#A80036;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="40.2969" y2="696.1719"/><line style="stroke:#A80036;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="262" x2="262" y1="40.2969" y2="696.1719"/><line style="stroke:#A80036;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="790" x2="790" y1="40.2969" y2="696.1719"/><rect fill="#FEFECE" filter="url(#f1lo4s9hdqn008)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="44" x="40" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="30" x="47" y="24.9951">App</text><rect fill="#FEFECE" filter="url(#f1lo4s9hdqn008)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="44" x="40" y="695.1719"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="30" x="47" y="715.167">App</text><rect fill="#FEFECE" filter="url(#f1lo4s9hdqn008)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="122" x="199" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="108" x="206" y="24.9951">Authentication</text><rect fill="#FEFECE" filter="url(#f1lo4s9hdqn008)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="122" x="199" y="695.1719"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="108" x="206" y="715.167">Authentication</text><rect fill="#FEFECE" filter="url(#f1lo4s9hdqn008)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="50" x="763" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="36" x="770" y="24.9951">IDTM</text><rect fill="#FEFECE" filter="url(#f1lo4s9hdqn008)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="50" x="763" y="695.1719"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="36" x="770" y="715.167">IDTM</text><path d="M10,57.2969 L207,57.2969 L207,64.2969 L197,74.2969 L10,74.2969 L10,57.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="621.875" style="stroke:#000000;stroke-width:2.0;" width="837" x="10" y="57.2969"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="25" y="70.3638">RefreshToken Error</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="262" y1="120.5625" y2="120.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="220" y1="120.5625" y2="133.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="261" y1="133.5625" y2="133.5625"/><polygon fill="#A80036" points="253,129.5625,263,133.5625,253,137.5625,257,133.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="182" x="80" y="115.4966">sends error analytics events</text><path d="M20,148.5625 L86,148.5625 L86,155.5625 L76,165.5625 L20,165.5625 L20,148.5625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="498.6094" style="stroke:#000000;stroke-width:2.0;" width="817" x="20" y="148.5625"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="161.6294">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="242" x="101" y="160.7729">[IDTM error is a retriable exception]</text><polygon fill="#A80036" points="778,207.8281,788,211.8281,778,215.8281,782,211.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="262" x2="784" y1="211.8281" y2="211.8281"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="504" x="269" y="206.7622">retries the refresh token request for 3x with exponential delay from 2 seconds</text><path d="M30,226.8281 L96,226.8281 L96,233.8281 L86,243.8281 L30,243.8281 L30,226.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="169.3359" style="stroke:#000000;stroke-width:2.0;" width="797" x="30" y="226.8281"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="45" y="239.895">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="149" x="111" y="239.0386">[success from retries]</text><polygon fill="#A80036" points="273,286.0938,263,290.0938,273,294.0938,269,290.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267" x2="789" y1="290.0938" y2="290.0938"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="180" x="279" y="285.0278">returns a valid access token</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="827" y1="299.0938" y2="299.0938"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="133" x="35" y="309.3042">[error from retries]</text><polygon fill="#A80036" points="273,355.0313,263,359.0313,273,363.0313,269,359.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267" x2="789" y1="359.0313" y2="359.0313"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="205" x="279" y="353.9653">returns exception to be handled</text><polygon fill="#A80036" points="75,384.1641,65,388.1641,75,392.1641,71,388.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="261" y1="388.1641" y2="388.1641"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104" x="81" y="383.0981">throws the error</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="837" y1="429.1641" y2="429.1641"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214" x="25" y="439.3745">[is any other type of exception]</text><path d="M30,474.9688 L96,474.9688 L96,481.9688 L86,491.9688 L30,491.9688 L30,474.9688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="140.2031" style="stroke:#000000;stroke-width:2.0;" width="305" x="30" y="474.9688"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="45" y="488.0356">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111" x="111" y="487.1792">[isUserLoggedIn]</text><polygon fill="#A80036" points="75,534.2344,65,538.2344,75,542.2344,71,538.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="261" y1="538.2344" y2="538.2344"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="174" x="81" y="533.1685">emits sesion expired event</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="335" y1="547.2344" y2="547.2344"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136" x="35" y="557.4448">[isUserNotLoggedIn]</text><polygon fill="#A80036" points="75,603.1719,65,607.1719,75,611.1719,71,607.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="69" x2="261" y1="607.1719" y2="607.1719"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="150" x="81" y="602.106">emits login failed event</text><!--MD5=[5695f9a812330b4a1a6046a09e78e4d7]
@startuml
!$PRIMARY = "#2A9FD6"
!$SECONDARY_DARK = "#777777"
!$BGCOLOR = "#LightBlue"
!$DARK = "#000000"

skinparam defaultFontName       "Verdana"

skinparam title {
	FontColor	                 $PRIMARY
	BorderColor	                 $SECONDARY_DARK
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              $BGCOLOR
}

!startsub sequence

skinparam sequence {
	BackgroundColor $BGCOLOR
	StartColor $PRIMARY
	EndColor $PRIMARY
	''
	BoxBackgroundColor $BGCOLOR
	BoxBorderColor $DARK
	BoxFontColor $DARK
	''
	DelayFontColor $DARK
	''
	LifeLineBorderThickness 2
	LifeLineBackgroundColor $BGCOLOR
	''
	GroupBorderColor $DARK
	GroupFontColor $DARK
	GroupBodyBackgroundColor $BGCOLOR
	GroupHeaderBackgroundColor $BGCOLOR
	''
	DividerBackgroundColor $BGCOLOR
    DividerBorderColor $DARK
    DividerBorderThickness 2
    DividerFontColor $DARK
	''
	ReferenceBackgroundColor $BGCOLOR
	ReferenceBorderColor $DARK
	ReferenceFontColor $DARK
	ReferenceHeaderBackgroundColor $BGCOLOR
}
!endsub

!procedure loop_arrowR()
  <<- - -
!endprocedure

participant App order 1
participant Authentication order 2
participant IDTM order 3

group RefreshToken Error
  |||
  Authentication <- - Authentication:  sends error analytics events
  alt IDTM error is a retriable exception
    |||
    Authentication -> IDTM: retries the refresh token request for 3x with exponential delay from 2 seconds
    alt success from retries
      |||
      Authentication <- IDTM: returns a valid access token
    else error from retries
      |||
      IDTM -> Authentication: returns exception to be handled
      Authentication - -> App: throws the error  
    end
    |||
  else is any other type of exception
    |||
    alt isUserLoggedIn
      |||
      Authentication - -> App: emits sesion expired event
    else isUserNotLoggedIn
      |||
      Authentication - -> App: emits login failed event
    end
    |||
  end
  |||
end
@enduml

@startuml

skinparam defaultFontName       "Verdana"

skinparam title {
	FontColor	                 #2A9FD6
	BorderColor	                 #777777
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #LightBlue
}


skinparam sequence {
	BackgroundColor #LightBlue
	StartColor #2A9FD6
	EndColor #2A9FD6
	BoxBackgroundColor #LightBlue
	BoxBorderColor #000000
	BoxFontColor #000000
	DelayFontColor #000000
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #LightBlue
	GroupBorderColor #000000
	GroupFontColor #000000
	GroupBodyBackgroundColor #LightBlue
	GroupHeaderBackgroundColor #LightBlue
	DividerBackgroundColor #LightBlue
    DividerBorderColor #000000
    DividerBorderThickness 2
    DividerFontColor #000000
	ReferenceBackgroundColor #LightBlue
	ReferenceBorderColor #000000
	ReferenceFontColor #000000
	ReferenceHeaderBackgroundColor #LightBlue
}


participant App order 1
participant Authentication order 2
participant IDTM order 3

group RefreshToken Error
  |||
  Authentication <- - Authentication:  sends error analytics events
  alt IDTM error is a retriable exception
    |||
    Authentication -> IDTM: retries the refresh token request for 3x with exponential delay from 2 seconds
    alt success from retries
      |||
      Authentication <- IDTM: returns a valid access token
    else error from retries
      |||
      IDTM -> Authentication: returns exception to be handled
      Authentication - -> App: throws the error  
    end
    |||
  else is any other type of exception
    |||
    alt isUserLoggedIn
      |||
      Authentication - -> App: emits sesion expired event
    else isUserNotLoggedIn
      |||
      Authentication - -> App: emits login failed event
    end
    |||
  end
  |||
end
@enduml

PlantUML version 1.2021.10(Mon Aug 30 13:43:48 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>