<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="739px" preserveAspectRatio="none" style="width:849px;height:739px;background:#FFFFFF;" version="1.1" viewBox="0 0 849 739" width="849px" zoomAndPan="magnify"><defs><filter height="300%" id="fuazoh5ev3x0x" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" filter="url(#fuazoh5ev3x0x)" height="621.875" style="stroke:#000000;stroke-width:2.0;" width="825" x="10" y="57.2969"/><rect fill="#ADD8E6" filter="url(#fuazoh5ev3x0x)" height="498.6094" style="stroke:#000000;stroke-width:2.0;" width="805" x="20" y="148.5625"/><rect fill="#ADD8E6" filter="url(#fuazoh5ev3x0x)" height="169.3359" style="stroke:#000000;stroke-width:2.0;" width="785" x="30" y="226.8281"/><rect fill="#ADD8E6" height="98.0703" style="stroke:none;stroke-width:1.0;" width="785" x="30" y="298.0938"/><rect fill="#ADD8E6" height="219.0078" style="stroke:none;stroke-width:1.0;" width="805" x="20" y="428.1641"/><rect fill="#ADD8E6" filter="url(#fuazoh5ev3x0x)" height="140.2031" style="stroke:#000000;stroke-width:2.0;" width="297.5" x="30" y="474.9688"/><rect fill="#ADD8E6" height="68.9375" style="stroke:none;stroke-width:1.0;" width="297.5" x="30" y="546.2344"/><line style="stroke:#A80036;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="62" x2="62" y1="40.2969" y2="696.1719"/><line style="stroke:#A80036;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="258.5" x2="258.5" y1="40.2969" y2="696.1719"/><line style="stroke:#A80036;stroke-width:2.0;stroke-dasharray:5.0,5.0;" x1="778" x2="778" y1="40.2969" y2="696.1719"/><rect fill="#FEFECE" filter="url(#fuazoh5ev3x0x)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="41" x="40" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="27" x="47" y="24.9951">App</text><rect fill="#FEFECE" filter="url(#fuazoh5ev3x0x)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="41" x="40" y="695.1719"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="27" x="47" y="715.167">App</text><rect fill="#FEFECE" filter="url(#fuazoh5ev3x0x)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="114" x="199.5" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="100" x="206.5" y="24.9951">Authentication</text><rect fill="#FEFECE" filter="url(#fuazoh5ev3x0x)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="114" x="199.5" y="695.1719"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="100" x="206.5" y="715.167">Authentication</text><rect fill="#FEFECE" filter="url(#fuazoh5ev3x0x)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="752" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="35" x="759" y="24.9951">IDTM</text><rect fill="#FEFECE" filter="url(#fuazoh5ev3x0x)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="752" y="695.1719"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="35" x="759" y="715.167">IDTM</text><path d="M10,57.2969 L197,57.2969 L197,64.2969 L187,74.2969 L10,74.2969 L10,57.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="621.875" style="stroke:#000000;stroke-width:2.0;" width="825" x="10" y="57.2969"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142" x="25" y="70.3638">RefreshToken Error</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="216.5" x2="258.5" y1="120.5625" y2="120.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="216.5" x2="216.5" y1="120.5625" y2="133.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="216.5" x2="257.5" y1="133.5625" y2="133.5625"/><polygon fill="#A80036" points="249.5,129.5625,259.5,133.5625,249.5,137.5625,253.5,133.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="180" x="78.5" y="115.4966">sends error analytics events</text><path d="M20,148.5625 L84,148.5625 L84,155.5625 L74,165.5625 L20,165.5625 L20,148.5625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="498.6094" style="stroke:#000000;stroke-width:2.0;" width="805" x="20" y="148.5625"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="35" y="161.6294">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="230" x="99" y="160.7729">[IDTM error is a retriable exception]</text><polygon fill="#A80036" points="766.5,207.8281,776.5,211.8281,766.5,215.8281,770.5,211.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="258.5" x2="772.5" y1="211.8281" y2="211.8281"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="496" x="265.5" y="206.7622">retries the refresh token request for 3x with exponential delay from 2 seconds</text><path d="M30,226.8281 L94,226.8281 L94,233.8281 L84,243.8281 L30,243.8281 L30,226.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="169.3359" style="stroke:#000000;stroke-width:2.0;" width="785" x="30" y="226.8281"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="45" y="239.895">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="140" x="109" y="239.0386">[success from retries]</text><polygon fill="#A80036" points="269.5,286.0938,259.5,290.0938,269.5,294.0938,265.5,290.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="263.5" x2="777.5" y1="290.0938" y2="290.0938"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179" x="275.5" y="285.0278">returns a valid access token</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="815" y1="299.0938" y2="299.0938"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="120" x="35" y="309.3042">[error from retries]</text><polygon fill="#A80036" points="269.5,355.0313,259.5,359.0313,269.5,363.0313,265.5,359.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="263.5" x2="777.5" y1="359.0313" y2="359.0313"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="204" x="275.5" y="353.9653">returns exception to be handled</text><polygon fill="#A80036" points="73.5,384.1641,63.5,388.1641,73.5,392.1641,69.5,388.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="257.5" y1="388.1641" y2="388.1641"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="102" x="79.5" y="383.0981">throws the error</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="825" y1="429.1641" y2="429.1641"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="202" x="25" y="439.3745">[is any other type of exception]</text><path d="M30,474.9688 L94,474.9688 L94,481.9688 L84,491.9688 L30,491.9688 L30,474.9688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="140.2031" style="stroke:#000000;stroke-width:2.0;" width="297.5" x="30" y="474.9688"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="45" y="488.0356">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="109" x="109" y="487.1792">[isUserLoggedIn]</text><polygon fill="#A80036" points="73.5,534.2344,63.5,538.2344,73.5,542.2344,69.5,538.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="257.5" y1="538.2344" y2="538.2344"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="172" x="79.5" y="533.1685">emits sesion expired event</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="327.5" y1="547.2344" y2="547.2344"/><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="131" x="35" y="557.4448">[isUserNotLoggedIn]</text><polygon fill="#A80036" points="73.5,603.1719,63.5,607.1719,73.5,611.1719,69.5,607.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="257.5" y1="607.1719" y2="607.1719"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148" x="79.5" y="602.106">emits login failed event</text><!--MD5=[d47e3b1e8cde042f60cea379a9ae4c27]
@startuml

!include authentication-theme.puml

participant App order 1
participant Authentication order 2
participant IDTM order 3

group RefreshToken Error
  |||
  Authentication <- - Authentication:  sends error analytics events
  alt IDTM error is a retriable exception
    |||
    Authentication -> IDTM: retries the refresh token request for 3x with exponential delay from 2 seconds
    alt success from retries
      |||
      Authentication <- IDTM: returns a valid access token
    else error from retries
      |||
      IDTM -> Authentication: returns exception to be handled
      Authentication - -> App: throws the error  
    end
    |||
  else is any other type of exception
    |||
    alt isUserLoggedIn
      |||
      Authentication - -> App: emits sesion expired event
    else isUserNotLoggedIn
      |||
      Authentication - -> App: emits login failed event
    end
    |||
  end
  |||
end
@enduml

@startuml



skinparam defaultFontName       "Verdana"

skinparam title {
	FontColor	                 #2A9FD6
	BorderColor	                 #777777
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #LightBlue
}


skinparam sequence {
	BackgroundColor #LightBlue
	StartColor #2A9FD6
	EndColor #2A9FD6
	BoxBackgroundColor #LightBlue
	BoxBorderColor #000000
	BoxFontColor #000000
	DelayFontColor #000000
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #LightBlue
	GroupBorderColor #000000
	GroupFontColor #000000
	GroupBodyBackgroundColor #LightBlue
	GroupHeaderBackgroundColor #LightBlue
	DividerBackgroundColor #LightBlue
    DividerBorderColor #000000
    DividerBorderThickness 2
    DividerFontColor #000000
	ReferenceBackgroundColor #LightBlue
	ReferenceBorderColor #000000
	ReferenceFontColor #000000
	ReferenceHeaderBackgroundColor #LightBlue
}



participant App order 1
participant Authentication order 2
participant IDTM order 3

group RefreshToken Error
  |||
  Authentication <- - Authentication:  sends error analytics events
  alt IDTM error is a retriable exception
    |||
    Authentication -> IDTM: retries the refresh token request for 3x with exponential delay from 2 seconds
    alt success from retries
      |||
      Authentication <- IDTM: returns a valid access token
    else error from retries
      |||
      IDTM -> Authentication: returns exception to be handled
      Authentication - -> App: throws the error  
    end
    |||
  else is any other type of exception
    |||
    alt isUserLoggedIn
      |||
      Authentication - -> App: emits sesion expired event
    else isUserNotLoggedIn
      |||
      Authentication - -> App: emits login failed event
    end
    |||
  end
  |||
end
@enduml

PlantUML version 1.2021.11(Sat Oct 02 13:26:11 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>